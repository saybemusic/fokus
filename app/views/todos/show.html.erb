<div class="todo-page fk-container">
  <%# <%= link_to objective_path(@objective), class: "back-link" do %>
    <%# <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="$noir" d="m4 10l-.707.707L2.586 10l.707-.707zm17 8a1 1 0 1 1-2 0zM8.293 15.707l-5-5l1.414-1.414l5 5zm-5-6.414l5-5l1.414 1.414l-5 5zM4 9h10v2H4zm17 7v2h-2v-2zm-7-7a7 7 0 0 1 7 7h-2a5 5 0 0 0-5-5z"/></svg> %>
  <%# <% end %>
  <div class="fk-header" id="showtodo">
    <h1 class="todo-fk-title"><%= @todo.title %></h1>
    <p class="todo-fk-subtitle"><strong>Jour :</strong> <%= @todo.to_ordered_day() %></p>
  </div>

  <div class="todo-main-card">
    <div class="todo-cards-scroll">
      <% @todo.tasks.order(:priority).each do |task| %>
        <% if task.completed %>
          <%= render partial: "tasks/complete_card", locals: { task: task } %>
        <% else %>
          <%= render partial: "tasks/uncomplete_card", locals: { task: task } %>
        <% end %>
      <% end %>
      <% @todo.tasks.each do |task| %>
        <% if task.priority == 1 && !task.completed %>
          <a href="#" class="bouton w-100 my-2 fokus-btn"
            data-bs-toggle="modal"
            data-bs-target="#fokusModal"
            data-task-name="<%= task.title %>"
            id="fokus-btn">
            FOKUS
          </a>
        <% end %>
      <% end %>
    </div>
    <div class="dbtn">
      <% if @objective_completed %>
        <div id="<%= dom_id(@todo, "next_todo") %>">
          <p>Bravo, vous avez atteint votre objectif !</p>
        </div>
          <%= link_to "VOIR MES OBJECTIFS", objectives_path(@objective), class: "bouton fokus-btn" %>
      <% else %>
        <% if @todo_just_completed %>
          <%= link_to "JOUR SUIVANT", next_day_path(@todo), class: "bouton fokus-btn", id: dom_id(@todo, "next_todo") %>
        <% else %>
          <div id="<%= dom_id(@todo, "next_todo") %>"></div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<div class="modal fade"
     id="fokusModal"
     tabindex="-1"
     data-bs-backdrop="static"
     data-bs-keyboard="false"
     data-controller="fokus">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close btn-close-black" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <h5 id="fokusModalLabel">
          <span id="taskName" data-fokus-target="taskName"></span>
        </h5>

        <div class="timer-container" data-fokus-target="timerContainer">
          <svg class="analog-timer" viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="85" fill="none" stroke="#e0e0e0" stroke-width="8"/>
            <circle cx="100" cy="100" r="85" fill="none" stroke="#003901" stroke-width="8"
                    stroke-linecap="round" stroke-dasharray="534" stroke-dashoffset="534"
                    data-fokus-target="progressRing"
                    style="transform: rotate(-90deg); transform-origin: 50% 50%;"/>
            <g class="clock-marks">
              <% (0..11).each do |i| %>
                <line x1="100" y1="20" x2="100" y2="35"
                      stroke="#999" stroke-width="3"
                      transform="rotate(<%= i * 30 %>, 100, 100)"
                      stroke-linecap="round"/>
              <% end %>
            </g>
            <foreignObject x="60" y="60" width="80" height="80">
              <div xmlns="http://www.w3.org/1999/xhtml" class="timer-center">
                <div id="timer" data-fokus-target="timerDisplay">
                </div>
              </div>
            </foreignObject>
          </svg>
        </div>

        <div class="d-flex justify-content-center gap-2 mb-3">
          <a type="button"
                  class="bouton"
                  data-fokus-target="startButton"
                  data-action="click->fokus#start">
            DÃ©marrer
          </a>

          <a type="button"
                  class="bouton"
                  style="display: none;"
                  data-fokus-target="pauseButton"
                  data-action="click->fokus#pause">
            Pause
          </a>

          <a type="button"
                  class="bouton"
                  data-fokus-target="stopButton"
                  data-action="click->fokus#stop">
            Reset
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
